<wutu-lib-style></wutu-lib-style>
<div class="dummies" *ngIf="true">
	<div class="selectBox" #selectBoxDummy><ng-container [ngTemplateOutlet]="checkboxRef"></ng-container></div>
	<div #actionMenuDummy><ng-container [ngTemplateOutlet]="actionMenuBtnRef"></ng-container></div>
	<div class="configButton" #configBtnDummy><ng-container [ngTemplateOutlet]="configBtnRef"></ng-container></div>
</div>

<div class="topButtons">
	<div>
		<span *ngIf="hasAtLeastOneResult()">{{translate('Showing %from%-%to% of %total% results', {from: (page -1) * itemsPerPage + 1, to: (page -1) * itemsPerPage + pageData.data.length, total: pageData.totalAmount})}}</span>
	</div>
	<div class="searchAndMultiSelect">
		<ng-container *ngIf="showSearchField" [ngTemplateOutlet]="searchInputRef" [ngTemplateOutletContext]="{changeHandler: searchQueryChanged, searchQuery: searchQuery}"></ng-container>
		<ng-container *ngIf="showFiltersBtn" [ngTemplateOutlet]="filterBtnRef" [ngTemplateOutletContext]="{clickHandler: openFilters, nrOfActiveFilters: getNrOfActiveFilters()}"></ng-container>
		<div class="multiSelectActionMenu" *ngIf="getSelectedRows().length > 0">
			{{translate('Selected %length% item(s)', {length: getSelectedRows().length})}}
			<div class="actionMenuContainer" *ngIf="getActionsForMultipleRowsFn?.(getSelectedRows())?.length > 0" #actionMenuContainer>
				<ng-container [ngTemplateOutlet]="actionMenuBtnRef" [ngTemplateOutletContext]="{clickHandler: getShowActionsMultipleFn()}"></ng-container>
				<div
					*ngIf="multipleRowsActionsShown"
					class="actionMenu"
					[ngStyle]="{transform: 'translate('+actionMenuOffset.x+ 'px,'+ actionMenuOffset.y + 'px)'}"
				>
					<button *ngFor="let action of actions" (click)="closeActionMenu(); action.action()">
						{{action.caption}}
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

<div
	class="tableContainer"
	#tableContainer
	[ngClass]="{horizontalScroll: horizontalScroll || columnWidthsToBeCalculated}"
>
	<ng-container *ngIf="!loading && !hasAtLeastOneResult()" [ngTemplateOutlet]="emptyTpl"></ng-container>
	<ng-container *ngIf="allowSelectingAcrossMultiplePages">
		<div class="selectAcrossPagesTooltip" *ngIf="shouldShowSelectAcrossAllPagesTooltip()">
			<div *ngIf="selectAllAcrossPagesLoading">
				{{translate('Please wait while we are collecting the data...')}}
			</div>
			<ng-container *ngIf="!selectAllAcrossPagesLoading">
				<div *ngIf="getHeaderSelectState() === true && selectAllAcrossPagesActive === false">
					{{translate('You can')}}
					<button class="textButton" (click)="selectAllAcrossPages()">
						{{translate('select all %total% items across all pages', {total: pageData.totalAmount})}}
					</button>
				</div>
				<div *ngIf="selectAllAcrossPagesActive">
					{{translate('You are selecting across pages.')}} <button class="textButton" (click)="stopSelectingAcrossPages()">{{translate('Deselect everything')}}</button>
				</div>
			</ng-container>
		</div>
	</ng-container>
	<table *ngIf="hasAtLeastOneResult()" [ngClass]="{actionMenuOpen: hasActionMenuOpen(), fullWidth: !columnWidthsToBeCalculated}">
		<thead>
		<tr>
			<td (click)="headerSelectClicked()" class="selectBoxContainer" *ngIf="getActionsForMultipleRowsFn">
				<div class="selectBox">
					<ng-container [ngTemplateOutlet]="checkboxRef" [ngTemplateOutletContext]="{isSelected: getHeaderSelectState()}"></ng-container>
				</div>
			</td>
			<td *ngFor="let headerKey of headerKeys">
				<div class="colHeader">
					<div class="caption" [klpWithTooltip]="true" (click)="setSortField(headerKey)">{{headerCaptionByKey.get(headerKey)}}</div>
					<button class="sortButton" *ngIf="isSortable(headerKey)" (click)="setSortField(headerKey)">
						<svg width="8" height="13" *ngIf="sortField !== headerKey || !sortOrder" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M4.63388 0.366116C4.14573 -0.122039 3.35427 -0.122039 2.86612 0.366116L0.21967 3.01256C-0.0732233 3.30546 -0.0732233 3.78033 0.21967 4.07322C0.512563 4.36612 0.987437 4.36612 1.28033 4.07322L3.75 1.60355L6.21967 4.07322C6.51256 4.36612 6.98744 4.36612 7.28033 4.07322C7.57322 3.78033 7.57322 3.30546 7.28033 3.01256L4.63388 0.366116Z" fill="#CCCCCC"/>
							<path d="M7.28033 9.07337L4.63388 11.7198C4.14573 12.208 3.35427 12.208 2.86612 11.7198L0.21967 9.07337C-0.0732233 8.78048 -0.0732233 8.30561 0.21967 8.01271C0.512563 7.71982 0.987437 7.71982 1.28033 8.01271L3.75 10.4824L6.21967 8.01271C6.51256 7.71982 6.98744 7.71982 7.28033 8.01271C7.57322 8.30561 7.57322 8.78048 7.28033 9.07337Z" fill="#CCCCCC"/>
						</svg>
						<svg width="8" height="13" *ngIf="sortField === headerKey && sortOrder === 'DESC'" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M4.63388 0.366116C4.14573 -0.122039 3.35427 -0.122039 2.86612 0.366116L0.21967 3.01256C-0.0732233 3.30546 -0.0732233 3.78033 0.21967 4.07322C0.512563 4.36612 0.987437 4.36612 1.28033 4.07322L3.75 1.60355L6.21967 4.07322C6.51256 4.36612 6.98744 4.36612 7.28033 4.07322C7.57322 3.78033 7.57322 3.30546 7.28033 3.01256L4.63388 0.366116Z" fill="#CCCCCC"/>
							<path d="M7.28033 9.07337L4.63388 11.7198C4.14573 12.208 3.35427 12.208 2.86612 11.7198L0.21967 9.07337C-0.0732233 8.78048 -0.0732233 8.30561 0.21967 8.01271C0.512563 7.71982 0.987437 7.71982 1.28033 8.01271L3.75 10.4824L6.21967 8.01271C6.51256 7.71982 6.98744 7.71982 7.28033 8.01271C7.57322 8.30561 7.57322 8.78048 7.28033 9.07337Z" fill="#4A4A4A"/>
						</svg>
						<svg width="8" height="13" *ngIf="sortField === headerKey && sortOrder === 'ASC'" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M4.63388 0.366116C4.14573 -0.122039 3.35427 -0.122039 2.86612 0.366116L0.21967 3.01256C-0.0732233 3.30546 -0.0732233 3.78033 0.21967 4.07322C0.512563 4.36612 0.987437 4.36612 1.28033 4.07322L3.75 1.60355L6.21967 4.07322C6.51256 4.36612 6.98744 4.36612 7.28033 4.07322C7.57322 3.78033 7.57322 3.30546 7.28033 3.01256L4.63388 0.366116Z" fill="#4A4A4A"/>
							<path d="M7.28033 9.07337L4.63388 11.7198C4.14573 12.208 3.35427 12.208 2.86612 11.7198L0.21967 9.07337C-0.0732233 8.78048 -0.0732233 8.30561 0.21967 8.01271C0.512563 7.71982 0.987437 7.71982 1.28033 8.01271L3.75 10.4824L6.21967 8.01271C6.51256 7.71982 6.98744 7.71982 7.28033 8.01271C7.57322 8.30561 7.57322 8.78048 7.28033 9.07337Z" fill="#CCCCCC"/>
						</svg>
					</button>
				</div>
			</td>
			<td class="configButtonContainer">
				<ng-container [ngTemplateOutlet]="configBtnRef" [ngTemplateOutletContext]="{clickHandler: openConfig}"></ng-container>
			</td>
		</tr>
		</thead>
		<tbody>
		<ng-container *ngFor="let row of pageData?.data; let i = index">
			<tr>
				<td (click)="rowSelectClicked(row)" class="selectBoxContainer" *ngIf="getActionsForMultipleRowsFn">
					<div class="selectBox">
						<ng-container [ngTemplateOutlet]="checkboxRef" [ngTemplateOutletContext]="{isSelected: isSelected(row)}"></ng-container>
					</div>
				</td>
				<td *ngFor="let header of headerKeys" (click)="rowClicked(row, i)" [klpWithTooltip]="true">
					<ng-container
						[ngTemplateOutlet]="getTemplate(header, row[header])"
						[ngTemplateOutletContext]="{ value: row[header], row: row }"
					></ng-container>
				</td>
				<td>
					<div class="actionMenuContainer" *ngIf="getActionsForRowFn?.(row)?.length > 0">
						<ng-container [ngTemplateOutlet]="actionMenuBtnRef" [ngTemplateOutletContext]="{clickHandler: getShowActionsFn(row)}"></ng-container>
						<div
							class="actionMenu"
							*ngIf="actionMenuForRow === row"
							[ngStyle]="{transform: 'translate('+actionMenuOffset.x+ 'px,'+ actionMenuOffset.y + 'px)'}"
						>
							<button *ngFor="let action of actions" (click)="closeActionMenu(); action.action()">
								{{action.caption}}
							</button>
						</div>
					</div>
				</td>
			</tr>
			<tr *ngIf="getExpandedTplFn?.()?.index === i">
				<td colspan="999">
					<ng-container [ngTemplateOutlet]="getExpandedTplFn()?.tpl" [ngTemplateOutletContext]="{row: row}"></ng-container>
				</td>
			</tr>
		</ng-container>
		</tbody>
	</table>
</div>

<footer>
	<div class="amountPicker">
		{{translate('Show')}}
		<div class="selectContainer">
			<select [(ngModel)]="itemsPerPage" (ngModelChange)="itemsPerPageChanged()">
				<option value="10">10</option>
				<option value="25">25</option>
				<option value="50">50</option>
				<option value="100">100</option>
			</select>
		</div>
		{{translate('results')}}
	</div>
	<div class="pageNumbers" *ngIf="pageData">
		<button *ngIf="false" (click)="toPage(1)" [disabled]="page === 1">{{translate('First')}}</button>
		<button (click)="toPage(page-1)" [disabled]="page === 1" class="withIcon">
			<svg width="12" height="12" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M12.8333 7.00002H1.16663M1.16663 7.00002L6.99996 12.8334M1.16663 7.00002L6.99996 1.16669" stroke="#475467" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
			</svg>
			<div>{{translate('Previous')}}</div>
		</button>
		<div class="pageNrButtons">
			<ng-container *ngFor="let pageNr of getPageNumbers()">
				<button class="pageNrButton" *ngIf="pageNr !== null" (click)="toPage(pageNr)" [ngClass]="{selected: page === pageNr}">
					<span>{{pageNr}}</span>
				</button>
				<button class="pageNrButton separator" *ngIf="pageNr == null">
					<span>...</span>
				</button>
			</ng-container>
		</div>
		<button (click)="toPage(page+1)" [disabled]="page === this.getLastPage()" class="withIcon">
			<div>{{translate('Next')}}</div>
			<svg width="12" height="12" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M1.16675 7.00002H12.8334M12.8334 7.00002L7.00008 1.16669M12.8334 7.00002L7.00008 12.8334" stroke="#475467" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
			</svg>
		</button>
		<button *ngIf="false" (click)="toPage(this.getLastPage())" [disabled]="page === this.getLastPage()">{{translate('Last')}}</button>
	</div>
</footer>

<div class="columnRearranger" *ngIf="showConfig">
	<header>
		<div>{{translate('Configure your dashboard')}}</div>
		<button class="closeButton" (click)="closeConfig()">×</button>
	</header>
	<div class="subHeader">{{translate('Pick and order the columns to personalize your dashboard')}}</div>
	<wutu-column-rearranger [(ngModel)]="definedColumns" [headerCaptionByKey]="headerCaptionByKey" (onCloseRequest)="closeConfig()" (onColumnsSaved)="onColumnsSaved()"></wutu-column-rearranger>
</div>

<div class="filters" *ngIf="showFilters">
	<header>
		<div>{{translate('Filters')}}</div>
		<button class="closeButton" (click)="closeFilters()">×</button>
	</header>
	<div class="filterFormContainer">
		<ng-container [ngTemplateOutlet]="filterFormTpl"></ng-container>
	</div>
</div>
